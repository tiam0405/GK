<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gk_bk.mapper.PostMapper">
  <resultMap id="PostMap" type="com.gk_bk.domain.Post">
    <id property="id" column="id" />
    <result property="authorId" column="author_id" />
    <result property="title" column="title" />
    <result property="content" column="content" />
    <result property="viewCount" column="view_count" />
    <result property="createdAt" column="created_at" />
    <result property="updatedAt" column="updated_at" />
  </resultMap>

  <insert id="insert" parameterType="com.gk_bk.domain.Post" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO posts (author_id, title, content, view_count, created_at, updated_at)
    VALUES (#{authorId}, #{title}, #{content}, 0, NOW(), NOW())
  </insert>

  <update id="update" parameterType="com.gk_bk.domain.Post">
    UPDATE posts
    SET title = #{title},
        content = #{content},
        updated_at = NOW()
    WHERE id = #{id} AND author_id = #{authorId}
  </update>

  <delete id="delete">
    DELETE FROM posts WHERE id = #{id} AND author_id = #{authorId}
  </delete>

  <select id="findById" parameterType="long" resultMap="PostMap">
    SELECT * FROM posts WHERE id = #{id}
  </select>

  <select id="findPage" resultMap="PostMap">
    SELECT * FROM posts ORDER BY id DESC LIMIT #{limit} OFFSET #{offset}
  </select>

  <select id="count" resultType="long">
    SELECT COUNT(1) FROM posts
  </select>
</mapper>

